<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MXNVD4PJ');
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>URL Parser</title>
    <meta name="description" content="Form to insert and analyze URLs with Domain Info.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MXNVD4PJ"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <div class="container">
        <h1>URL Parser</h1>
        <form id="urlForm">
            <div class="form-group">
                <label for="urlInput">Enter URL:</label>
                <input type="text" class="form-control" id="urlInput"
                       placeholder="https://example.com/path?param=value#fragment">
            </div>
            <div id="button-container">
                <button type="button" class="btn btn-primary" id="parseButton" disabled>Parse</button>
                <p>&nbsp;</p> 
                <button type="button" class="btn btn-primary" id="decodeButton" disabled>Decode</button>
            </div>
        </form>
        <div id="output-container" class="mt-4">
            <h2>Analysis Result:</h2>
            <div class="table-responsive">
                <table id="parsedResult" class="url-table">
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <hr>
    <div id="youtube-embed-container">
        <iframe></iframe>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const regexp = {
            UrlParts: /^((?:\w+:\/\/)?[^\/.:]+(?:\.[^\/.:?#]+)+)((?:\/?(?:[^\/?#]+)?)*)?(\?[^?]+?)?(#[^#]+?)?$/,
            KeyOptionalValue: /([^?#&=]+)(?:=([^?#&=]+))?/,
            YouTubeVideo: /(https?:\/\/)?(www\.)?(m\.)?youtu(\.be|be\.com)\/(?:embed\/|watch\?v=)?([0-9A-Za-z_-]{11})/
        };

        const parseKeyOptionalValue = (captureGroup, keyOptionalValue) => {
            if (captureGroup) {
                captureGroup = captureGroup.substring(1);
                const params = captureGroup.split('&');
                params.forEach(param => {
                    const parts = param.split('=');
                    const key = parts[0];
                    const value = parts.length > 1 ? parts[1] : '';
                    keyOptionalValue.list.push(`<span class="math-inline">\{key\}</span>{value ? '=' + value : ''}`);
                    keyOptionalValue.obj[key] = value;
                });
            }
        }

        const parseUrl = (url) => {
            url = url.replaceAll('\\', '');
            const match = url.match(regexp.UrlParts);
            if (!match) {
                return undefined;
            }
            const domain = match[1] || '';
            const path = match[2] || '/';
            const queryString = match[3] || '';
            const hashString = match[4] || '';
            let parameters = { str: queryString, list: [], obj: {} }
            let fragment = { str: hashString, list: [], obj: {} }
            parseKeyOptionalValue(queryString, parameters);
            parseKeyOptionalValue(hashString, fragment);

            return {
                parts: {
                    domain: domain,
                    path: path,
                    parameters: parameters,
                    fragment: fragment
                },
                fullUrl: function () {
                    return domain + path + queryString + hashString;
                }
            };
        };

        document.addEventListener('DOMContentLoaded', function () {
            const parseButton = document.getElementById('parseButton');
            const urlInput = document.getElementById('urlInput');
            const parsedResultTableBody = document.querySelector('#parsedResult tbody');
            const decodeButton = document.getElementById('decodeButton');

            const validateUrlInput = () => {
                const url = urlInput.value.replaceAll('\\', '');
                const parsed = parseUrl(url);
                if (parsed && parsed.parts.domain) {
                    urlInput.classList.remove('invalid');
                    urlInput.classList.add('valid');
                    parseButton.disabled = false;
                    decodeButton.disabled = false;
                } else {
                    urlInput.classList.remove('valid');
                    urlInput.classList.add('invalid');
                    parseButton.disabled = true;
                    decodeButton.disabled = true;
                }
            };

            urlInput.addEventListener('input', validateUrlInput);

            const handleParse = (decode) => {
                const url = urlInput.value.replaceAll('\\', '');

                if (url.startsWith('youtu.be')) {
                    window.location.href = url;
                    return;
                }

                const r = parseUrl(url);
                parsedResultTableBody.innerHTML = '';
                document.getElementById('output-container').querySelectorAll('#youtube-embed-container, .youtube-message-container').forEach(el => el.remove());
                document.body.classList.remove('youtube-background');

                if (!r) {
                    const row = parsedResultTableBody.insertRow();
                    const cell = row.insertCell();
                    cell.colSpan = 2;
                    cell.textContent = "Invalid URL.";
                    return;
                }

                let isOdd = true;

                const addTableRow = (label, value, isOdd, isSubtable = false, isDomainRow = false, domain = '') => {
                    const row = parsedResultTableBody.insertRow();
                    const bgColor = isOdd ? (isSubtable ? '#2a2a2a' : '#222') : (isSubtable ? '#333' : '#282828');
                    row.style.backgroundColor = bgColor;
                    const labelCell = row.insertCell();
                    const valueCell = row.insertCell();
                    labelCell.textContent = label;
                    valueCell.innerHTML = value || '-';
                    labelCell.style.fontWeight = 'bold';
                    labelCell.style.paddingRight = '15px';
                    valueCell.style.color = '#ccc';
                    valueCell.style.backgroundColor = isOdd ? (isSubtable ? '' : '#333') : (isSubtable ? '' : '#3a3a3a');

                    if (isDomainRow && domain) {
                        const faviconUrl = `https://www.google.com/s2/favicons?domain=${domain}`;
                        const faviconImg = document.createElement('img');
                        faviconImg.src = faviconUrl;
                        faviconImg.width = 18;
                        faviconImg.height = 18;
                        faviconImg.style.marginRight = '8px';
                        faviconImg.style.verticalAlign = 'middle';

                        const domainLink = document.createElement('a');
                        domainLink.href = domain;
                        domainLink.className = 'url-link';
                        domainLink.textContent = domain;

                        valueCell.innerHTML = '';

                        faviconImg.onload = function() {
                            valueCell.appendChild(faviconImg);
                            valueCell.appendChild(domainLink);
                        };
                        faviconImg.onerror = function() {
                            valueCell.appendChild(domainLink);
                        };
                        valueCell.appendChild(domainLink);
                    }
                };

                let domain = r.parts.domain;
                let fullUrl = r.fullUrl();
                let path = r.parts.path;

                addTableRow("Domain", domain, isOdd, false, true, domain);
                isOdd = !isOdd;
                addTableRow("Path", path, isOdd);
                isOdd = !isOdd;

                if (r.parts.parameters.list.length > 0) {
                    addTableRow("Parameters", decode?decodeURIComponent(r.parts.parameters.str):r.parts.parameters.str, isOdd);
                    isOdd = !isOdd;
                    let paramsSubTable = '<table class="sub-table">';
                    let index = 0;
                    let maxKeyWidth = 0;

                    for (const key in r.parts.parameters.obj) {
                        const value = r.parts.parameters.obj[key] || '';
                        const decodedKey = decode ? decodeURIComponent(key) : key;
                        const decodedValue = decode ? decodeURIComponent(value) : value;
                        const keyHTML = `<span class="param-key-sub">${decodedKey}</span>`;

                        const tempDiv = document.createElement('div');
                        tempDiv.style.position = 'absolute';
                        tempDiv.style.visibility = 'hidden';
                        tempDiv.style.whiteSpace = 'nowrap';
                        tempDiv.innerHTML = keyHTML;
                        document.body.appendChild(tempDiv);
                        maxKeyWidth = Math.max(maxKeyWidth, tempDiv.offsetWidth);
                        document.body.removeChild(tempDiv);

                        paramsSubTable += `<tr style="background-color: ${index % 2 === 0 ? '#2a2a2a' : '#333'}"><td class="param-key-cell" style="width: ${maxKeyWidth}px">${keyHTML}</td><td class="param-value-cell">${decodedValue}</td></tr>`;
                        index++;
                    }
                    paramsSubTable += '</table>';
                    addTableRow("Detailed Parameters", paramsSubTable, isOdd, true);
                    isOdd = !isOdd;
                }

                if (r.parts.fragment.list.length > 0) {
                    addTableRow("Fragment", decode?decodeURIComponent(r.parts.fragment.str):r.parts.fragment.str, isOdd);
                    isOdd = !isOdd;
                    let fragmentSubTable = '<table class="sub-table">';
                    let index = 0;
                    let maxKeyWidth = 0;

                    for (const key in r.parts.fragment.obj) {
                        const value = r.parts.fragment.obj[key] || '';
                        const decodedKey = decode ? decodeURIComponent(key) : key;
                        const decodedValue = decode ? decodeURIComponent(value) : value;
                        const keyHTML = `<span class="param-key-sub">${decodedKey}</span>`;

                        const tempDiv = document.createElement('div');
                        tempDiv.style.position = 'absolute';
                        tempDiv.style.visibility = 'hidden';
                        tempDiv.style.whiteSpace = 'nowrap';
                        tempDiv.innerHTML = keyHTML;
                        document.body.appendChild(tempDiv);
                        maxKeyWidth = Math.max(maxKeyWidth, tempDiv.offsetWidth);
                        document.body.removeChild(tempDiv);

                        fragmentSubTable += `<tr style="background-color: ${index % 2 === 0 ? '#2a2a2a' : '#333'}"><td class="param-key-cell" style="width: ${maxKeyWidth}px">${keyHTML}</td><td class="param-value-cell">${decodedValue}</td></tr>`;
                        index++;
                    }
                    fragmentSubTable += '</table>';
                    addTableRow("Detailed Fragment", fragmentSubTable, isOdd, true);
                    isOdd = !isOdd;
                }

                addTableRow("Full URL", `<a href="${fullUrl}" class="url-link">${decode?decodeURIComponent(fullUrl):fullUrl}</a>`, isOdd);

                const iframe = document.querySelector('#youtube-embed-container iframe');
                if (regexp.YouTubeVideo.test(url)) {
                    document.body.classList.add('youtube-background');
                    const match = url.match(regexp.YouTubeVideo);
                    const videoId = match && match[5];
                    if (videoId) {
                        iframe.width = 560;
                        iframe.height = 512;
                        iframe.src = `https://www.youtube.com/embed/${videoId}`;
                        iframe.src += '?autoplay=1&mute=1&enablejsapi=1';
                        iframe.src += `&origin=${encodeURIComponent(window.location.hostname)}`;
                        if (r.parts.parameters.obj.hasOwnProperty('t') && /\d+/.test(r.parts.parameters.obj.t)) {
                            iframe.src += '&start=' + r.parts.parameters.obj.t.replace('s', '');;
                        } else if (r.parts.parameters.obj.hasOwnProperty('start') && /\d+/.test(r.parts.parameters.obj.start))
                            iframe.src += '&start=' + r.parts.parameters.obj.start.replace('s', '');
                        // iframe["data-gtm-yt"] = "true";
                        iframe.frameBorder = '0';
                        iframe.allowFullscreen = true;
                    } else {
                        const messageContainer = document.createElement('div');
                        messageContainer.classList.add('youtube-message-container');
                        messageContainer.style.marginTop = '20px';
                        messageContainer.style.color = '#ffaa00';
                        messageContainer.textContent = "Não foi possível extrair o ID do vídeo.";
                        document.getElementById('output-container').appendChild(messageContainer);
                    }
                } else {
                    iframe.src = '';
                }
            };

            parseButton.addEventListener('click', () => handleParse(false));
            decodeButton.addEventListener('click', () => handleParse(true));

            urlInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    if (!parseButton.disabled) {
                        handleParse(false);
                    }
                }
            });
        });
    </script>
</body>
<script type="text/javascript">
    console.log(" _   _______ _       ______                                      \n| | | | ___ \\ |     | ___ \\                                       \n| | | | |_/ / |     | |_/ /_ _ _ __ ___ ___ _ __ \n| | | |  __/| |     |  __/ _` | '__/ __|/ _ \\ '__|\n| |_| | |\\ \\| |____ | | | (_| | |  \\__ \\  __/ |   \n \\___/\\_| \\_/_____/ \\_|  \\__,_|_|  |___/\\___|_|   \n\nhttps://github.com/tomasfn87/url-parser\n\n");
</script>
</html>

